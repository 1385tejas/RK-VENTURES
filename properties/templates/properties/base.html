<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}RK Ventures{% endblock %}</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f6f8; margin: 0; }
        .header { background: #2d3e50; color: #fff; padding: 1.5rem 2rem; display: flex; justify-content: space-between; align-items: center; position:sticky; top:0; z-index:1000; }
        .header a { color: #fff; text-decoration: none; margin-left: 1.5rem; font-weight: bold; }
        .header a:focus { outline: 2px solid #fff; outline-offset: 2px; }
        .container { max-width: 1100px; margin: 2rem auto; padding: 2rem; background: #fff; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); }
        .btn { display: inline-block; padding: 0.5rem 1.2rem; background: #2d3e50; color: #fff; border-radius: 5px; text-decoration: none; font-weight: bold; transition: background 0.2s; }
        .btn:hover { background: #1e2a38; }
        input, select, textarea { font-size: 1rem; border-radius: 6px; border: 1.5px solid #ccc; padding: 0.5rem 0.7rem; }
        label { font-size: 1.01rem; color: #8a1832; font-weight: 500; }
        form { width: 100%; }
        footer { background: #2d3e50; color: #fff; padding: 2rem 0 1rem 0; text-align: center; margin-top: 3rem; }
        footer a { color: #fff; text-decoration: none; margin: 0 0.5rem; font-size: 1.1rem; }
        footer a:focus { outline: 2px solid #fff; outline-offset: 2px; }
        @media (max-width: 600px) {
            .container { padding: 0.5rem !important; margin: 0.5rem 0 !important; border-radius: 8px !important; }
            .header { flex-direction: row; padding: 0.7rem 0.7rem; }
            .header > div { font-size: 1.2rem !important; }
            .btn { font-size: 1rem !important; padding: 0.4rem 1rem !important; }
            input, select, textarea { font-size: 1rem !important; padding: 0.45rem 0.6rem !important; }
            form { padding: 0 !important; }
            .navbar-toggle { display: flex !important; align-items: center; justify-content: center; background: none; border: none; color: #fff; font-size: 2.1rem; margin-left: 1.2rem; cursor: pointer; z-index: 2001; }
            .navbar-links {
                display: none !important;
                flex-direction: column;
                align-items: flex-start;
                position: fixed;
                top: 0; left: 0; right: 0;
                background: rgba(138,24,50,0.98);
                padding-top: 70px;
                min-height: 100vh;
                z-index: 2000;
                box-shadow: 0 4px 32px rgba(0,0,0,0.18);
            }
            .navbar-links.open { display: flex !important; }
            .navbar-links a {
                margin: 0;
                padding: 1.1rem 2rem;
                width: 100%;
                border-radius: 0;
                border-bottom: 1px solid #fff2;
                font-size: 1.13rem;
            }
        }
        .navbar-toggle { display: none; }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body>
<input type="hidden" id="csrfmiddlewaretoken" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
    <div class="header" style="background: #8a1832; color: #fff; padding: 0.7rem 2.5rem; display: flex; align-items: center; justify-content: space-between; position:sticky; top:0; z-index:1000; min-height:60px;">
        <div style="font-size: 1.7rem; font-weight: bold; letter-spacing: 1px;">RK Ventures</div>
        <button class="navbar-toggle" aria-label="Toggle navigation" id="navbarToggleBtn" style="display:none;">
          <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect y="7" width="32" height="3.5" rx="1.5" fill="white"/>
            <rect y="14" width="32" height="3.5" rx="1.5" fill="white"/>
            <rect y="21" width="32" height="3.5" rx="1.5" fill="white"/>
          </svg>
        </button>
        <nav class="navbar-links" id="navbarLinks" style="display: flex; align-items: center; gap: 2.2rem;">
            <a href="/" style="color:#fff; text-decoration:none; font-weight:500; font-size:1.13rem; padding: 0.2rem 0.7rem; border-radius: 6px; transition: background 0.18s;">Home</a>
            <a href="/properties/" style="color:#fff; text-decoration:none; font-weight:500; font-size:1.13rem; padding: 0.2rem 0.7rem; border-radius: 6px; transition: background 0.18s;">Properties</a>
            <a href="/about/" style="color:#fff; text-decoration:none; font-weight:500; font-size:1.13rem; padding: 0.2rem 0.7rem; border-radius: 6px; transition: background 0.18s;">About</a>
            <a href="/contact/" style="color:#fff; text-decoration:none; font-weight:500; font-size:1.13rem; padding: 0.2rem 0.7rem; border-radius: 6px; transition: background 0.18s;">Contact</a>
            {% if user.is_authenticated %}
                <a href="/upload-properties/" style="color:#fff; text-decoration:none; font-weight:500; font-size:1.13rem; padding: 0.2rem 0.7rem; border-radius: 6px; transition: background 0.18s;">Upload Properties</a>
                <span style="color:#fff; font-size:1.05rem; margin-left:1.2rem; margin-right:0.7rem;">Welcome, {{ user.username }}</span>
                <a href="/accounts/logout/" style="color:#8a1832; background: #fff; border-radius: 2rem; padding: 0.35rem 1.3rem; font-weight: bold; font-size: 1.08rem; text-decoration: none; margin-left: 0.5rem; transition: background 0.18s, color 0.18s;">Logout</a>
                <!-- Notification Bell Icon -->
                <div id="notif-bell-container" style="position:relative; margin-left:1.5rem;">
                  <button id="notif-bell" aria-label="Notifications" style="background:none;border:none;cursor:pointer;outline:none;position:relative;">
                    <svg width="28" height="28" fill="none" stroke="#fff" stroke-width="2" viewBox="0 0 24 24" style="vertical-align:middle;"><path d="M12 22c1.1 0 2-.9 2-2H10c0 1.1.9 2 2 2zm6-6V11c0-3.07-1.63-5.64-4.5-6.32V4a1.5 1.5 0 0 0-3 0v.68C7.63 5.36 6 7.92 6 11v5l-1.29 1.29A1 1 0 0 0 6 19h12a1 1 0 0 0 .71-1.71L18 17z"/></svg>
                    <span id="notif-badge" style="display:none;position:absolute;top:0;right:0;background:#e74c3c;color:#fff;border-radius:50%;padding:2px 7px;font-size:0.85rem;font-weight:bold;">0</span>
                  </button>
                  <div id="notification-area" style="display:none;position:absolute;top:36px;right:0;z-index:99999;min-width:320px;max-width:400px;background:#fff;border-radius:10px;box-shadow:0 4px 24px rgba(44,62,80,0.18);padding:0;font-size:1.08rem;color:#222;flex-direction:column;gap:1rem;max-height:400px;overflow-y:auto;"></div>
                </div>
            {% else %}
                <a href="/accounts/login/" style="color:#8a1832; background: #fff; border-radius: 2rem; padding: 0.35rem 1.3rem; font-weight: bold; font-size: 1.08rem; text-decoration: none; margin-left: 0.5rem; transition: background 0.18s, color 0.18s;">Login</a>
                <a href="/accounts/register/" style="color:#fff; border: 1.5px solid #fff; border-radius: 2rem; padding: 0.35rem 1.3rem; font-weight: bold; font-size: 1.08rem; text-decoration: none; margin-left: 0.5rem; transition: background 0.18s, color 0.18s;">Register</a>
            {% endif %}
        </nav>
    </div>
    {% block content %}{% endblock %}
    <footer>
        <div style="margin-bottom:1rem;">
            <a href="https://instagram.com" target="_blank" aria-label="Instagram" style="margin:0 0.5rem;vertical-align:middle;">
                <svg width="24" height="24" fill="currentColor" aria-hidden="true" focusable="false" viewBox="0 0 24 24" style="vertical-align:middle;"><path d="M12 2.2c3.2 0 3.584.012 4.85.07 1.17.056 1.97.24 2.43.41.59.22 1.01.48 1.45.92.44.44.7.86.92 1.45.17.46.354 1.26.41 2.43.058 1.266.07 1.65.07 4.85s-.012 3.584-.07 4.85c-.056 1.17-.24 1.97-.41 2.43-.22.59-.48 1.01-.92 1.45-.44.44-.7-.86-.92-1.45-.17-.46-.354-1.26-.41-2.43C2.212 15.784 2.2 15.4 2.2 12s.012-3.584.07-4.85c.056-1.17.24-1.97.41-2.43.22-.59.48-1.01.92-1.45.44-.44.86-.7 1.45-.92.46-.17 1.26-.354 2.43-.41C8.416 2.212 8.8 2.2 12 2.2zm0-2.2C8.736 0 8.332.013 7.052.072 5.77.13 4.77.31 4.01.54c-.77.23-1.42.54-2.07 1.19C1.29 2.38.98 3.03.75 3.8c-.23.76-.41 1.76-.47 3.04C.013 8.332 0 8.736 0 12c0 3.264.013 3.668.072 4.948.058 1.282.238 2.282.47 3.04.23.77.54 1.42 1.19 2.07.65.65 1.3.96 2.07 1.19.76.23 1.76.41 3.04.47C8.332 23.987 8.736 24 12 24s3.668-.013 4.948-.072c1.282-.058 2.282-.238 3.04-.47.77-.23 1.42-.54 2.07-1.19.65-.65.96-1.3 1.19-2.07.23-.76.41-1.76.47-3.04.059-1.28.072-1.684.072-4.948s-.013-3.668-.072-4.948c-.058-1.282-.238-2.282-.47-3.04-.23-.77-.54-1.42-1.19-2.07C21.62 1.29 20.97.98 20.2.75c-.76-.23-1.76-.41-3.04-.47C15.668.013 15.264 0 12 0zm0 5.838A6.162 6.162 0 0 0 5.838 12 6.162 6.162 0 0 0 12 18.162 6.162 6.162 0 0 0 18.162 12 6.162 6.162 0 0 0 12 5.838zm0 10.162A4 4 0 1 1 16 12a4 4 0 0 1-4 4zm6.406-10.844a1.44 1.44 0 1 1-2.88 0 1.44 1.44 0 0 1 2.88 0z"/></svg>
            </a>
            <a href="https://facebook.com" target="_blank" aria-label="Facebook" style="margin:0 0.5rem;vertical-align:middle;">
                <svg width="24" height="24" fill="currentColor" aria-hidden="true" focusable="false" viewBox="0 0 24 24" style="vertical-align:middle;"><path d="M22.675 0h-21.35C.595 0 0 .592 0 1.326v21.348C0 23.408.595 24 1.325 24h11.495v-9.294H9.692v-3.622h3.128V8.413c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.797.143v3.24l-1.918.001c-1.504 0-1.797.715-1.797 1.763v2.313h3.587l-.467 3.622h-3.12V24h6.116C23.406 24 24 23.408 24 22.674V1.326C24 .592 23.406 0 22.675 0"/></svg>
            </a>
            <a href="https://twitter.com" target="_blank" aria-label="Twitter" style="margin:0 0.5rem;vertical-align:middle;">
                <svg width="24" height="24" fill="currentColor" aria-hidden="true" focusable="false" viewBox="0 0 24 24" style="vertical-align:middle;"><path d="M24 4.557a9.83 9.83 0 0 1-2.828.775 4.932 4.932 0 0 0 2.165-2.724c-.951.564-2.005.974-3.127 1.195a4.916 4.916 0 0 0-8.38 4.482C7.691 8.095 4.066 6.13 1.64 3.161c-.542.93-.856 2.01-.857 3.17 0 2.188 1.115 4.117 2.823 5.254a4.904 4.904 0 0 1-2.229-.616c-.054 2.281 1.581 4.415 3.949 4.89a4.936 4.936 0 0 1-2.224.084c.627 1.956 2.444 3.377 4.6 3.417A9.867 9.867 0 0 1 0 21.543a13.94 13.94 0 0 0 7.548 2.209c9.142 0 14.307-7.721 13.995-14.646A9.936 9.936 0 0 0 24 4.557z"/></svg>
            </a>
            <a href="https://linkedin.com" target="_blank" aria-label="LinkedIn" style="margin:0 0.5rem;vertical-align:middle;">
                <svg width="24" height="24" fill="currentColor" aria-hidden="true" focusable="false" viewBox="0 0 24 24" style="vertical-align:middle;"><path d="M20.447 20.452h-3.554v-5.569c0-1.327-.027-3.037-1.849-3.037-1.851 0-2.132 1.445-2.132 2.939v5.667H9.358V9h3.414v1.561h.049c.476-.899 1.637-1.849 3.37-1.849 3.602 0 4.267 2.368 4.267 5.455v6.285zM5.337 7.433a2.062 2.062 0 1 1 0-4.124 2.062 2.062 0 0 1 0 4.124zM7.119 20.452H3.554V9h3.565v11.452zM22.225 0H1.771C.792 0 0 .771 0 1.723v20.549C0 23.229.792 24 1.771 24h20.451C23.2 24 24 23.229 24 22.271V1.723C24 .771 23.2 0 22.225 0z"/></svg>
            </a>
        </div>
        <div style="font-size: 0.95rem;">&copy; {{ now|default:2025 }} RK Ventures. All rights reserved.</div>
    </footer>
    {% if not user.is_authenticated %}
    <div id="authModal" style="display:none;position:fixed;z-index:99999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;">
        <div style="background:#fff;padding:2.5rem 2rem 2rem 2rem;border-radius:14px;box-shadow:0 4px 32px rgba(0,0,0,0.18);max-width:350px;width:90%;text-align:center;position:relative;">
            <button id="closeAuthModal" style="position:absolute;top:10px;right:16px;background:none;border:none;font-size:2rem;color:#888;cursor:pointer;">&times;</button>
            <h2 style="margin-bottom:1.2rem;">Welcome to RK Ventures</h2>
            <p style="margin-bottom:1.5rem;">Register or Login to unlock all features!<br>Or continue as guest to browse public listings.</p>
            <a href="/accounts/login/" class="btn" style="margin-bottom:0.7rem;width:100%;display:block;">Login</a>
            <a href="/accounts/register/" class="btn" style="background:#1e7e34;width:100%;display:block;">Register</a>
        </div>
    </div>
    {% endif %}
    {% if not user.is_authenticated %}
    <script>
    window.addEventListener('DOMContentLoaded', function() {
        if (!sessionStorage.getItem('authModalDismissed')) {
            document.getElementById('authModal').style.display = 'flex';
        }
        document.getElementById('closeAuthModal').onclick = function() {
            document.getElementById('authModal').style.display = 'none';
            sessionStorage.setItem('authModalDismissed', '1');
        };
    });
    </script>
    {% endif %}
    {% block extra_scripts %}
<script>
(function() {
    if ({{ user.is_authenticated|yesno:'true,false' }}) {
        var notifBell = document.getElementById('notif-bell');
        var notifArea = document.getElementById('notification-area');
        var notifBadge = document.getElementById('notif-badge');

        // Fetch notifications from backend
        function fetchNotifications() {
            fetch('/notifications/api/')
                .then(response => response.json())
                .then(data => {
                    renderNotifications(data.notifications || []);
                });
        }

        // Render notifications
        function renderNotifications(notifs) {
            notifArea.innerHTML = '';
            if (notifs.length === 0) {
                notifArea.innerHTML = '<div style="padding:1.2rem;text-align:center;color:#888;">No notifications</div>';
                notifBadge.style.display = 'none';
            } else {
                // Add Clear All button
                var clearAllBtn = document.createElement('button');
                clearAllBtn.textContent = 'Clear All';
                clearAllBtn.style = 'background:#e74c3c;color:#fff;border:none;border-radius:6px;padding:0.5rem 1.2rem;font-size:1rem;font-weight:bold;cursor:pointer;margin:0.7rem 0 0.7rem 0;float:right;';
                clearAllBtn.onclick = function() {
                    fetch('/notifications/api/clear_all/', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/x-www-form-urlencoded', 
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                        }
                    }).then(function(response) {
                        if (response.ok) {
                            renderNotifications([]); 
                            notifBadge.style.display = 'none';
                        }
                    });
                };
                notifArea.appendChild(clearAllBtn);
                notifBadge.textContent = notifs.length;
                notifBadge.style.display = 'inline-block';
                notifs.forEach(function(n) {
                    var nEl = document.createElement('div');
                    nEl.style = 'background:' + (n.read ? '#f4f4f4' : '#f9f6ff') + ';border-radius:10px;box-shadow:0 2px 8px rgba(44,62,80,0.10);padding:1.1rem 1.5rem 1.1rem 1.2rem;margin-bottom:0.5rem;position:relative;display:flex;align-items:center;';
                    // Remove (delete) button
                    var removeBtn = document.createElement('span');
                    removeBtn.textContent = 'Ã—';
                    removeBtn.title = 'Remove notification';
                    removeBtn.style = 'margin-left:auto;font-size:1.3rem;color:#e74c3c;cursor:pointer;font-weight:bold;padding-left:1rem;';
                    removeBtn.onclick = function(e) {
                        e.stopPropagation();
                        fetch('/notifications/api/delete/', {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/x-www-form-urlencoded', 
                                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                            },
                            body: 'id=' + encodeURIComponent(n.id)
                        }).then(function(response) {
                            if (response.ok) {
                                fetchNotifications();
                            }
                        });
                    };
                    if (n.property_id) {
                        nEl.innerHTML = '<a href="/properties/' + n.property_id + '/" target="_blank" style="color:#8a1832;text-decoration:none;' + (n.read ? 'font-weight:normal;' : 'font-weight:bold;') + 'background:transparent;border-radius:7px;padding:0.7rem 1rem;display:block;transition:background 0.18s;">' +
                            '<b style="font-size:1.13rem;">' + n.title + '</b><br>' + n.message + '<br><span style="font-size:0.92rem;color:#888;">' + n.created_at + '</span></a>';
                        nEl.querySelector('a').onclick = function(e) {
                            fetch('/notifications/api/mark_read/', {
                                method: 'POST',
                                headers: { 
                                    'Content-Type': 'application/x-www-form-urlencoded', 
                                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                                },
                                body: 'id=' + encodeURIComponent(n.id)
                            }).then(function(response) {
                                if (response.ok) {
                                    nEl.style.background = '#f4f4f4'; 
                                    nEl.querySelector('a').style.fontWeight = 'normal';
                                }
                            });
                        };
                    } else {
                        nEl.innerHTML = '<b style="color:#8a1832;font-size:1.13rem;' + (n.read ? 'font-weight:normal;' : 'font-weight:bold;') + '">' + n.title + '</b><br>' + n.message + '<br><span style="font-size:0.92rem;color:#888;">' + n.created_at + '</span>';
                        nEl.onclick = function() {
                            fetch('/notifications/api/mark_read/', {
                                method: 'POST',
                                headers: { 
                                    'Content-Type': 'application/x-www-form-urlencoded', 
                                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                                },
                                body: 'id=' + encodeURIComponent(n.id)
                            }).then(function(response) {
                                if (response.ok) {
                                    nEl.style.background = '#f4f4f4'; 
                                    nEl.querySelector('b').style.fontWeight = 'normal';
                                }
                            });
                        };
                    }
                    nEl.appendChild(removeBtn);
                    notifArea.appendChild(nEl);
                });
            }
        }

        // On bell click, fetch and show notifications
        notifBell.onclick = function(e) {
            notifArea.style.display = notifArea.style.display === 'flex' ? 'none' : 'flex';
            if (notifArea.style.display === 'flex') {
                fetchNotifications();
            }
        };
        // Hide dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!notifArea.contains(e.target) && !notifBell.contains(e.target)) {
                notifArea.style.display = 'none';
            }
        });
        // Fetch notifications on page load for badge
        fetch('/notifications/api/')
            .then(response => response.json())
            .then(data => {
                var notifs = data.notifications || [];
                if (notifs.length > 0) {
                    notifBadge.textContent = notifs.length;
                    notifBadge.style.display = 'inline-block';
                } else {
                    notifBadge.style.display = 'none';
                }
            });
    }
})();
</script>
<script>
// Mobile navbar toggle logic
(function() {
  var toggleBtn = document.getElementById('navbarToggleBtn');
  var navLinks = document.getElementById('navbarLinks');
  if (toggleBtn && navLinks) {
    toggleBtn.addEventListener('click', function(e) {
      navLinks.classList.toggle('open');
      e.stopPropagation();
    });
    // Close menu when a link is tapped (mobile)
    navLinks.querySelectorAll('a').forEach(function(link) {
      link.addEventListener('click', function() {
        navLinks.classList.remove('open');
      });
    });
    // Optional: close menu if user taps outside
    document.addEventListener('click', function(e) {
      if (navLinks.classList.contains('open') && !navLinks.contains(e.target) && e.target !== toggleBtn) {
        navLinks.classList.remove('open');
      }
    });
  }
})();
</script>
{% endblock %}
</body>
</html> 